# ZenBreath 需求文档 (PRD)

## 1. 文档目标
定义 ZenBreath 的关键需求、用户故事和验收标准，确保后续开发与测试有统一目标。

## 2. 产品定位
ZenBreath 是一个单页沉浸式呼吸冥想工具，帮助用户在 5-15 分钟内完成可引导、可配置、可收敛的正念呼吸练习。

## 3. 目标用户
- 新手用户：需要简单上手、明确节奏引导。
- 进阶用户：需要自定义呼吸节奏与时长。
- 放松场景用户：需要环境音和视觉氛围辅助沉浸。

## 4. 核心目标
- 让用户在 10 秒内完成配置并开始练习。
- 提供稳定可持续的四段呼吸引导体验（吸气/屏息/吐气/屏息）。
- 保证声音、视觉和计时在会话期间一致且可控。

## 5. 范围定义
### 5.1 In Scope
- 呼吸模式选择：预设 + 自定义四段时长。
- 会话时长：5 分、10 分、自定义、无尽模式。
- 环境音：地/水/火/风/空 + 音量开关。
- 本地偏好记忆：记住上次配置并支持“一键继续上次练习”。
- 本地练习洞察：展示今日练习次数与累计分钟。
- 会话流程：开始、暂停、自动结束。
- 视觉反馈：背景切换、粒子效果、呼吸球状态变化、倒计时与状态文字。

### 5.2 Out of Scope
- 用户账号和云端同步。
- 历史练习数据存储。
- 多人协作或社交功能。
- 后端服务依赖。

## 6. 关键功能需求
- FR-01 设置面板  
  用户可配置呼吸模式、时长、环境音和音量，并通过“开始冥想”启动会话。

- FR-02 呼吸状态机  
  系统按四段节奏循环执行：`inhale -> hold1 -> exhale -> hold2 -> inhale`，并允许任意阶段时长为 0。

- FR-03 时间管理  
  提供全局剩余时间显示；无尽模式显示“深空无尽”；倒计时到 0 后自动收尾。

- FR-04 视觉引导  
  每阶段提供明显且平滑的视觉差异（缩放、透明度、光圈、粒子模式、文本）。

- FR-05 声音引导  
  会话激活时播放环境音；阶段切换时播放提示音；支持音量实时调节和开关。

- FR-06 容错与降级  
  背景图加载失败时使用渐变兜底；音频初始化失败不得导致页面核心交互崩溃。

- FR-07 可中断性  
  用户在会话中可通过设置按钮中断并调整配置，重新开始后状态应一致。

- FR-08 无死循环要求  
  自定义时长全为 0 时必须自动纠正，避免相位递归或空转。

- FR-09 上次配置记忆  
  系统应自动保存最近一次有效配置（模式、时长、环境音、音量与开关），下次打开可恢复并支持一键开始。

- FR-10 今日练习洞察  
  系统应在本地记录“今日练习次数/累计时长（分钟）”，并在界面展示。

- FR-11 移动端可用性  
  在小屏幕上设置面板与关键按钮应可完整显示、可点击、无明显遮挡。

- FR-12 环境音切换平滑性  
  切换环境音时应避免突兀断裂，听感上保持平滑过渡。

## 7. 用户故事 (User Stories)
- US-01  
  作为新手，我希望一键开始并看到“吸气/屏息/吐气”的明确提示，这样我可以不思考流程直接跟练。

- US-02  
  作为进阶用户，我希望能自定义四段秒数，这样我可以使用自己的呼吸法。

- US-03  
  作为碎片时间用户，我希望可选固定时长或无尽模式，这样我能按场景安排练习。

- US-04  
  作为听觉敏感用户，我希望能切换环境音和音量，这样我能保持舒适体验。

- US-05  
  作为沉浸用户，我希望每次吸气时背景和语录有变化，这样体验不会单调。

- US-06  
  作为稳定性关注者，我希望在切换环境音时不会出现静音或错误状态，这样我不用刷新页面恢复。

- US-07  
  作为回访用户，我希望能一键继续上次练习，这样我不用重复设置。

- US-08  
  作为自我管理用户，我希望看到今日练习次数和时长，这样我能感知进度。

## 8. 非功能需求 (NFR)
- NFR-01 性能  
  常规设备上保持顺畅动画；会话开始响应时间 < 500ms（不含首次音频授权交互）。

- NFR-02 稳定性  
  连续运行 10 分钟不出现未捕获异常；音频链路不进入 bad state。

- NFR-03 兼容性  
  支持 Chromium 内核现代浏览器（Edge/Chrome）最新稳定版。

- NFR-04 可用性  
  关键操作可在 3 次点击内完成（配置 -> 开始 -> 练习）。

## 9. 验收标准
- AC-01 默认配置下点击“开始冥想”后，状态文字与倒计时应开始变化，且全局计时可见。
- AC-02 切换任一环境音后，会话中应继续有可听见背景音，不影响阶段提示音。
- AC-03 设置任意阶段为 0 秒时，流程仍连续推进且页面不报错。
- AC-04 固定时长模式倒计时结束后，进入结束文案并退出会话状态。
- AC-05 无尽模式不会自动结束，且全局时间文本显示“深 空 无 尽”。
- AC-06 刷新页面后应能恢复上次配置，且“继续上次练习”按钮可用。
- AC-07 会话结束后“今日练习次数/分钟”应更新并可见。
- AC-08 移动端（390x844）设置面板可完整显示，开始/继续按钮可点击。
- AC-09 1 分钟内高频切换环境音 30 次，不应出现卡死、静音锁死或 `bad state` 错误。
